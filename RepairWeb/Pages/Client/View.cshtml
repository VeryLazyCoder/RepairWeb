@page "{id}"
@using RepairWeb.Data.Models
@model RepairWeb.Pages.Client.ViewModel
@{
    ViewData["Title"] = Model.Request.Equipment;
}

<h1 class="text-center">Подробности заявки</h1>

<form method="post" id="editRequestForm">
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <strong>Оборудование</strong>
                        <div>@Model.Request.Equipment</div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <strong>Статус заявки</strong>
                        <div>@Model.Request.Status</div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <strong>Дата создания</strong>
                        <div>@Model.Request.RequestDate.ToString("dd.MM.yyyy")</div>
                    </div>
                </div>
            </div>

            @if (Model.Request.Status == RequestStatus.Fulfill)
            {
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <strong>Дата выполнения</strong>
                            <div>@Model.Request.FulfillDate.ToString("dd.MM.yyyy")</div>
                        </div>
                    </div>
                </div>
            }

            <div class="col-md-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <strong>Описание проблемы</strong>
                        <textarea id="descriptionField" name="ProblemDescription" class="form-control">@Model.Request.ProblemDescription</textarea>
                    </div>
                </div>
            </div>

            <div class="col-md-12 mb-4">
                <div class="card">
                    <div class="card-body">
                        <strong>Серийный номер</strong>
                        <textarea id="serialNumberField" name="SerialNumber" class="form-control">@Model.Request.SerialNumber</textarea>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <strong>Имя мастера</strong>
                        <div>@Model.Request.ExecutorName</div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <strong>Комментарий мастера</strong>
                        <div>@Model.Request.ExecutorComment</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-end mt-3">
            <button type="submit" class="btn btn-success" id="saveChangesButton" style="display: none;">Сохранить изменения</button>
        </div>
    </div>
</form>

<form method="post" asp-page-handler="Delete" class="d-inline">
    <a asp-page="/Repair/Client" class="btn btn-secondary mt-3">Назад</a>
    <input type="hidden" name="id" value="@Model.Request.RequestId" />
    <button type="submit" class="btn btn-danger mt-3" onclick="return confirm('Вы уверены, что хотите удалить эту заявку?');">
        Удалить
    </button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const descriptionField = document.getElementById('descriptionField');
        const serialNumberField = document.getElementById('serialNumberField');
        const saveButton = document.getElementById('saveChangesButton');

        // Сохраняем исходное значение поля
        const originalDescription = descriptionField.value;

        // Отслеживаем изменения в поле "Описание"
        descriptionField.addEventListener('input', function () {
            saveButton.style.display = 'inline-block'; // Показать кнопку
        });
        serialNumberField.addEventListener('input', function () {
            saveButton.style.display = 'inline-block'; // Показать кнопку
        });
    });
</script>
